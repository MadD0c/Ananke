[gcode_macro BED_LEVEL]
gcode:
    {% set defaultcfg = printer['gcode_macro _defaultcfg'] %} ; get default variables
    {% set notifycfg = printer['gcode_macro _notifycfg'] %} ; get notify variables
    {% if defaultcfg.z_tilt == True %}
        {% if config.z_tilt is defined %}
            M{defaultcfg.notify_output} Calibrating Z ; status feedback
            {% if defaultcfg.notify_led_status == True %}
            {notifycfg.status_led_status_z_calibrating} ; LED feedback
            {% endif %}
            Z_TILT_ADJUST ; adjust z-tilt
        {% else %}
            M{defaultcfg.notify_error_output} Z_tilt not configured!
        {% endif %}
    {% elif defaultcfg.qgl == True %}
        {% if config.quad_gantry_level is defined %}
            M{defaultcfg.notify_output} Calibrating Z ; status feedback
            {% if defaultcfg.notify_led_status == True %}
              {notifycfg.status_led_status_z_calibrating} ; LED feedback
            {% endif %}
            QUAD_GANTRY_LEVEL  ; adjust QGL
        {% else %}
            M{defaultcfg.notify_error_output} QGL not configured!
        {% endif %}
    {% endif %}
