[gcode_macro _cfgupdate]
gcode:
  {% set usercfg = printer["gcode_macro _usercfg"] %}
  {% set defaultcfg = printer["gcode_macro _defaultcfg"] %}
  {% set output = [] %}
  {% for k in usercfg %}
    {% if k not in defaultcfg %}
        {% set dummy = output.append("%s is not valid for User Config." |format(k)) %}
    {% elif defaultcfg[k] is string %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="'{usercfg[k]|replace('\\','\\\\')|replace('\'','\\\'')|replace('\"','\\\"')}'"
    {% elif defaultcfg[k] is float %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="{usercfg[k]|float}"
    {% elif defaultcfg[k] is integer %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="{usercfg[k]|int}"
    {% elif defaultcfg[k] is boolean %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="{usercfg[k]}"
    {% elif defaultcfg[k] is mapping %}
      {% if usercfg[k] is not mapping %}
        {% set dummy = output.append("%s requires a mapping type." | format(k)) %}
      {% endif %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="{usercfg[k]|replace('\"','\\\"')}"
    {% elif defaultcfg[k] is sequence %}
      {% if usercfg[k] is not sequence %}
        {% set dummy = output.append("%s requires a sequence type." | format(k)) %}
      {% endif %}
      SET_GCODE_VARIABLE MACRO=_defaultcfg VARIABLE={k} VALUE="{usercfg[k]|replace('\"','\\\"')}"
    {% else %}
      {% set dummy = output.append("%s is not a valid type for User Config." | format(k)) %}
    {% endif %}
  {% endfor %}

[gcode_macro _kampupdate]
gcode:
    {% set kampcfg = printer["gcode_macro _KAMP_Settings"] %}
    {% set defaultcfg = printer["gcode_macro _defaultcfg"] %}
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=verbose_enable VALUE={ defaultcfg.kamp_verbose_enable }
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=mesh_margin  VALUE={ defaultcfg.kamp_mesh_margin|float } 
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=fuzz_amount  VALUE={ defaultcfg.kamp_fuzz_amount|float }  
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=probe_dock_enable  VALUE={ defaultcfg.docking_probe }
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=attach_macro  VALUE="{ defaultcfg.attach_macro }" 
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=detach_macro  VALUE="{ defaultcfg.dock_macro }" 
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=purge_height  VALUE={ defaultcfg.kamp_purge_height|float } 
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=tip_distance  VALUE={ defaultcfg.kamp_tip_distance|float } 
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=purge_margin  VALUE={ defaultcfg.kamp_purge_margin|float }
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=purge_amount  VALUE={ defaultcfg.kamp_purge_amount|float }
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=flow_rate  VALUE={ defaultcfg.kamp_flow_rate|float }
    SET_GCODE_VARIABLE MACRO=_KAMP_Settings VARIABLE=smart_park_height  VALUE={ defaultcfg.kamp_smart_park_height|float }
